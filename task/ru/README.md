# Антифрод REST API (олимпиадное задание)

Главный источник требований к API — OpenAPI-спецификация: `openapi.yml`.

## Быстрый старт

- Рекомендованный старт (для новичков): `docs/getting-started.md`.
- Полный текст задания и баллы: `docs/assignment.md`.
- Правила DSL (уровни поддержки, проверка, выполнение): `docs/dsl.md`.
- Локальный запуск и быстрая проверка: `docs/local-run.md`.
- FAQ и частые ошибки: `docs/faq.md`.
- Словарь терминов: `docs/glossary.md`.

## Структура репозитория

- `openapi.yml` — описание API.
- `docs/` — документация к заданию (что сделать и как это проверяется).

---

## Changelog

### v1.1.1 (Последнее изменение спецификации)

- Поле `timezone` возвращено в `GET /stats/transactions/timeseries`

### v1.1.0

- Уточнено, что фильтрация по `userId` игнорируется для USER в `GET /transactions`
- Поле `timezone` удалено из `GET /stats/overview` и `GET /stats/transactions/timeseries`
- Исправлены мелкие опечатки.

### v1.0.9

- Уточнено, что поля `amount` и `gmv` в `/transactions` и `/stats` хранятся до 2 знаков после запятой
(иначе округляются по правилам математики)

### v1.0.8

- Добавлено стандартное значение для `from` в `GET /transactions`
- Исправлены мелкие опечатки.

### v1.0.7

- Удалены упоминания `metadata` и `timestamp` из DSL.
- Исправлены мелкие опечатки.

### v1.0.6

- Уточнено, что поля `near` и `position` в `POST /fraud-rules/validate` проверяются только на наличие

### v1.0.5

- Откат валидации `dslExpression` в `POST /fraud-rules`: корректность выражения не валидируется.
- Добавлена сортировка правил для `GET /fraud-rules`: по `priority` (ASC).
- Поле `enabled` удалено из результатов транзакции
- Исправлены мелкие опечатки.

### v1.0.4

- Уточнено, что `dslExpression` валидируется в `POST /fraud-rules`, но метод не возвращает подробные ошибки DSL
- Исправлена валидация `ruleResults` в `POST /transactions`: нет сортировки по `id`
- Уточнено, что поле `userId` обязательно для `POST /transactions`
- Исправлены мелкие опечатки.

### v1.0.3

- Изменена сортировка пользователей для `GET /users`: по `createdAt` (ASC).
- Убран обязательный ответ `{"status": "ok"}` для `GET /ping`
- Уточнено правило формирования `lastSeenAt` для `GET /stats/users/{id}/risk-profile`: любое действие пользователя, включая создание администратором транзакции пользователя.
- Исправлены мелкие опечатки.

### v1.0.2 

- Добавлена таблица кодов ошибок с HTTP-статусами.
- Удалён код ошибки `USER_NOT_FOUND`, вместо него используется `NOT_FOUND`.
- Удалены коды ошибки `DSL_UNSUPPORTED_TIER` и `DSL_TOO_COMPLEX`, а также вся логика связанная с ними.
- Уточнено, что содержимое `message` и `fieldErrors[].issue` не проверяется автотестами.
- Добавлена сортировка пользователей для `GET /users`: по `id` (ASC).
- Добавлены правила валидации `page`/`size` (min/max) с 422 при невалидных значениях.
- Уточнена нормализация DSL: убираются лишние и не влияющие на логику скобки.
- Уточнено поле `near`: 2 символа до и 2 после позиции ошибки
- Исправлены мелкие опечатки.
- `gmv` теперь обязательный в MerchantRiskRow.

### v1.0.1

- OpenAPI: добавлен `expiresIn` в пример ответа авторизации, добавлен код 409 для `PUT /fraud-rules/{id}`.
- OpenAPI: убрана формулировка «если включена уникальность имени» - уникальность имени правила теперь обязательна.
- Обновлены примеры запуска в `local-run.md`.
- Исправлены мелкие опечатки.
